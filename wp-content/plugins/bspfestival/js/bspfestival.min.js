jQuery(document).ready(function(a){function t(){a(".series-wrapper").lightGallery({selector:".series-img",mousewheel:!1,download:!1,thumbnail:!1,autoplay:!1,fullScreen:!1,zoom:!1,facebook:!1,twitter:!1,googlePlus:!1,pinterest:!1,loop:!1})}function e(a){FB.ui({method:"feed",link:a},function(a){})}function s(t,e,s,o){if(!t.hasClass("fa-spinner")){var r={_ajax_nonce:bspf_ajax.nonce,action:"BSPFAjaxVoting",pid:e,vote:s};t.removeClass("fa-star fa-star-o").addClass("fa-spinner fa-spin"),a.post(bspf_ajax.ajax_url,r,function(a){if(a)if(s>0){e="public"==o?"Favorite!":"Remove vote";t.removeClass("fa-spinner fa-spin").addClass("fa-star").attr("title",e)}else{var e="public"==o?"Make favorite!":"Vote "+s;t.removeClass("fa-spinner fa-spin").addClass("fa-star-o").attr("title",e)}},"json")}}function o(){a(".icon-bspf-private").click(function(){r(a(this),"pid")}),a(".vote-series").click(function(){r(a(this),"gid")})}function r(t,e){var s=t.attr("data-vote"),o=t.parent().parent(),r=o.attr("data-vote"),i=o.attr("data-category"),n="pid"==e?o.attr("data-pid"):o.attr("data-gid"),f=t.attr("data-fa");o.children().each(function(){var t=a(this).find("i"),e=t.attr("data-vote"),o=t.attr("data-fa"),i=t.attr("data-sel"),n=t.attr("data-unsel");void 0!=e&&(t.addClass(o+"-o").removeClass(o).attr("title",n),s!=r&&(e>0&&e<s?t.addClass(o).removeClass(o+"-o").attr("title",n):e>0&&e==s?t.addClass(o).removeClass(o+"-o").attr("title",i):e<0&&e==s&&t.addClass(o).removeClass(o+"-o").attr("title",i)))}),s==r&&(t.addClass(f+"-o").removeClass(f).attr("title",t.attr("data-unsel")),s=0),o.attr("data-vote",s),l(n,s,o,e,i)}function i(e,s){var r=a("#bspf-filter"),i=r.attr("data-filter"),l=(r.attr("data-caption"),r.attr("data-category")),f=r.attr("data-group"),d=r.attr("data-gid"),p={_ajax_nonce:bspf_ajax.nonce,action:"BSPFAjaxFilter",filter:i,category:l,group:f,gid:d,page:s};a(".bspf-filter-text").html('<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>'),a(".bspf-filter-current-page").html('<i class="fa fa-spinner fa-spin" aria-hidden="true"></i>'),a.get(bspf_ajax.ajax_url,p,function(t){a(".bspf-filter-text").html(t.text),a(".bspf-filter-pages").html(t.pages),a(".bspf-gallery-ajax").html(t.content)},"json").done(function(){"down"==e&&a("html, body").animate({scrollTop:a(".bspf-gallery-ajax").offset().top-30},"slow"),o(),n(),t()})}function n(){a(".bspf-filter-page").click(function(){i(a(this).parent().parent().attr("data-position"),a(this).attr("data-page"))})}function l(t,e,s,o,r){var i={_ajax_nonce:bspf_ajax.nonce,action:"BSPFAjaxVoting",group_id:t,vote:e,private:!0,group:o,category:r},n=s.attr("data-scroll-num"),l=parseInt(a("div[data-scroll]:last").attr("data-scroll"))+1,f=a(n==l?"div[data-scroll-filter]":"div[data-scroll='"+n+"']");s.parent().find(".alert").remove(),s.hide().parent().append('<i class="fa fa-spinner fa-spin"></i>'),d(f),a.post(bspf_ajax.ajax_url,i,function(t){if("success"==t.status){if(s.show().parent().find(".fa-spinner").remove(),s.parent().find(".alert").remove(),t.values)for(var e in t.values.stats)a(".vote-"+e).html(t.values.stats[e])}else{var o='<div class="alert alert-danger alert-dismissable"> <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a> <strong>Error!</strong> '+t.message+"</div>";s.show().parent().find(".fa-spinner").remove(),s.parent().find(".alert").remove(),s.parent().append(o)}},"json")}function f(){a("#myModal").modal("show");var t={_ajax_nonce:bspf_ajax.nonce,action:"BSPFAjaxGetVote"};a.get(bspf_ajax.ajax_url,t,function(t){a(".star-bspf-public").removeClass("fa-star").addClass("fa-star-o").attr("title","Make favorite!");for(var e in t.voted)a(".star-bspf-public[data-pid='"+t.voted[e]+"']").removeClass("fa-star-o").addClass("fa-star").attr("title","Favorite!");a("#myModal").modal("hide")},"json")}function d(t){t.length&&a("html, body").animate({scrollTop:t.offset().top-30},"slow")}document.getElementsByClassName("pop")&&(a("#ModalImage").modal("show"),a(".pop").on("click",function(){a("#ModalImage").modal("show")})),a("#ModalImage").on("hidden.bs.modal",function(a){f()});var p=a(".bspf-gallery-wrapper");p.lightGallery({selector:".img-wrapper",mousewheel:!1,download:!1,thumbnail:!1,autoplay:!1,fullScreen:!1,zoom:!1,googlePlus:!1,pinterest:!1}),p.on("onCloseAfter.lg",function(a){f()}),p.on("onAfterAppendSubHtml.lg",function(t,e){var o=a(".lg-sub-html").find(".star-bspf-public");if(a(o).removeClass("fa-star fa-star-o").addClass("fa-spinner fa-spin"),!a(o).hasClass("checked")){var r={_ajax_nonce:bspf_ajax.nonce,action:"BSPFAjaxGetVote",pid:a(o).attr("data-pid")};a.get(bspf_ajax.ajax_url,r,function(t){a(o).hasClass("checked")||(!0===t.is_voted?a(o).removeClass("fa-spinner fa-spin").addClass("fa-star checked").attr("title","Favorite!"):a(o).removeClass("fa-spinner fa-spin").addClass("fa-star-o checked").attr("title","Make favorite!"))},"json")}a(".star-bspf-public").click(function(){var t=a(this).hasClass("fa-star-o")?5:0;s(a(this),a(this).attr("data-pid"),t,"public")})}),p.on("onSlideItemLoad.lg",function(t,e){var s=a(".lg-sub-html").find(".star-bspf-public"),o="https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(a(s).attr("data-url"))+"&picture="+encodeURIComponent(a(".lg-image:visible").attr("src"))+"&title="+encodeURIComponent(a(".lg-sub-html").text()+" - BSPF Social Media Voting")+"&caption="+encodeURIComponent("bspfestival.org")+"&description="+encodeURIComponent("Brussels Street Photography Festival contest submission entry. Vote on your favorite photo and help the photographer win the Social Media Prize."),r="https://twitter.com/intent/tweet?text=Vote for "+encodeURIComponent(a(s).attr("data-name"))+" on the BSPF Contest!&url="+encodeURIComponent(a(s).attr("data-url"))+"&hashtags=StreetPhotography,BSPF2017&via=BSPFestival_Off";a("#lg-share-facebook").attr("href",o),a("#lg-share-twitter").attr("href",r)}),a(".icon-bspf-filter").click(function(){var t=a("#bspf-filter"),e=t.attr("data-filter"),s=a(this).attr("data-filter"),o=a(this).attr("title");a(".icon-bspf-filter").each(function(){var t=a(this).attr("data-fa"),o=a(this).attr("data-filter");a(this).addClass(t+"-o").removeClass(t),s!=e&&(o>0&&o<=s?a(this).addClass(t).removeClass(t+"-o"):o<0&&o==s&&a(this).addClass(t).removeClass(t+"-o"))}),s==e&&(s=0,o="Non voted"),t.attr("data-filter",s),t.attr("data-caption",o)}),a(".bspf-filter-button").click(function(){i(a(this).attr("data-position"),1)}),o(),n(),t(),a(".star-bspf-public").click(function(){var t=a(this).hasClass("fa-star-o")?5:0;s(a(this),a(this).attr("data-pid"),t,"public")}),a(".facebook-share").on("click",function(){e(a(this).attr("data-url"))})});